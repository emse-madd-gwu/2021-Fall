<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>WTP &amp; Simulations</title>
    <meta charset="utf-8" />
    <meta name="author" content="John Paul Helveston" />
    <meta name="date" content="2021-11-10" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <meta name="description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta name="generator" content="xaringan and remark.js"/>
    <meta name="github-repo" content="emse-madd-gwu/2021-Fall"/>
    <meta name="twitter:title" content="WTP &amp; Simulations"/>
    <meta name="twitter:description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta name="twitter:url" content="https://madd.seas.gwu.edu/2021-Fall/"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@johnhelveston"/>
    <meta name="twitter:site" content="@johnhelveston"/>
    <meta property="og:title" content="WTP &amp; Simulations"/>
    <meta property="og:description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta property="og:url" content="https://madd.seas.gwu.edu/2021-Fall/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="John Paul Helveston"/>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="css/lexis.css" type="text/css" />
    <link rel="stylesheet" href="css/lexis-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: middle, inverse

.leftcol30[
&lt;center&gt;
&lt;img src="https://github.com/emse-madd-gwu/emse-madd-gwu.github.io/raw/master/images/madd_hex_sticker.png" width=250&gt;
&lt;/center&gt;
]

.rightcol70[
# Week 11: .fancy[WTP &amp; Simulations]

### <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M496 128v16a8 8 0 0 1-8 8h-24v12c0 6.627-5.373 12-12 12H60c-6.627 0-12-5.373-12-12v-12H24a8 8 0 0 1-8-8v-16a8 8 0 0 1 4.941-7.392l232-88a7.996 7.996 0 0 1 6.118 0l232 88A8 8 0 0 1 496 128zm-24 304H40c-13.255 0-24 10.745-24 24v16a8 8 0 0 0 8 8h464a8 8 0 0 0 8-8v-16c0-13.255-10.745-24-24-24zM96 192v192H60c-6.627 0-12 5.373-12 12v20h416v-20c0-6.627-5.373-12-12-12h-36V192h-64v192h-64V192h-64v192h-64V192H96z"/></svg> EMSE 6035: Marketing Analytics for Design Decisions
### <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"/></svg> John Paul Helveston
### <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"/></svg> November 10, 2021
]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. .orange[Computing "Willingness to Pay" (WTP)]
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---

class: center 

## Willingness to Pay (WTP)

&lt;br&gt;

## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`

&lt;br&gt;

--

## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`

---

class: center

# Notational convention

.leftcol[
# Model 
## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`
## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`
]

.rightcol[
# Estimated Model
## `$$\tilde{u}_j = \hat{\alpha} p_j + \hat{\boldsymbol{\beta}} x_j + \tilde{\varepsilon_j}$$`
## `$$\hat{\boldsymbol{\omega}} = \frac{\hat{\boldsymbol{\beta}}}{-\hat{\alpha}}$$`
]

---

class: inverse

# Practice Question 1

.leftcol[

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

The estimated model produces the following coefficients:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

]

.rightcol[
a) Use the estimated coefficients to compute the WTP for fuel economy and electric car vehicle type.
]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. .orange[Incorporating Uncertainty via Simulation]
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---

# .center[Simulating uncertainty]

We can use the coefficients and hessian from a model to obtain draws that reflect parameter uncertainty

.leftcol[

```r
beta &lt;- c(-0.7, 0.1, -4.0)

hessian &lt;- matrix(c(
    -6000,   50,   60,
       50, -700,   50,
       60,   50, -300),
    ncol = 3, byrow = TRUE)
```
]

.rightcol[

```r
covariance &lt;- -1*solve(hessian)
draws &lt;- MASS::mvrnorm(10^4, beta, covariance)

head(draws)
```

```
#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.7160458 0.14722660 -4.109681
#&gt; [2,] -0.7207909 0.16200449 -4.037364
#&gt; [3,] -0.7087197 0.10726160 -4.116090
#&gt; [4,] -0.6881458 0.05199936 -3.994739
#&gt; [5,] -0.6733345 0.05750150 -4.000815
#&gt; [6,] -0.6759333 0.05226912 -3.971867
```
]

---

# .center[Computing WTP with draws]

## `$$\hat{\boldsymbol{\omega}} = \frac{\hat{\boldsymbol{\beta}}}{-\hat{\alpha}}$$`

--

.leftcol55[

```r
draws_other &lt;- draws[,2:ncol(draws)]
draws_price &lt;- draws[,1]
draws_wtp &lt;- draws_other / (-1*draws_price)
head(draws_wtp)
```

```
#&gt;            [,1]      [,2]
#&gt; [1,] 0.20561058 -5.739411
#&gt; [2,] 0.22475935 -5.601298
#&gt; [3,] 0.15134559 -5.807782
#&gt; [4,] 0.07556445 -5.805076
#&gt; [5,] 0.08539812 -5.941794
#&gt; [6,] 0.07732881 -5.876122
```
]

--

.rightcol45[
Mean WTP with confidence interal

```r
maddTools::ci(draws_wtp)
```

```
#&gt;         mean       lower      upper
#&gt; 1  0.1439942  0.03892732  0.2522393
#&gt; 2 -5.7171543 -5.97769017 -5.4626804
```
]

---

class: inverse

## Practice Question 2

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

.leftcol[
The estimated model produces the following coefficients and hessian:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

$$
\nabla_{\beta}^2 \ln(\mathcal{L}) =
`\begin{bmatrix}
-6000 &amp; 50 &amp; 60
\\
50 &amp; -700 &amp; 50
\\
60 &amp; 50 &amp; -300
\end{bmatrix}`
$$
]

.rightcol[
a) Generate 10,000 draws of the model coefficients using the estimated coefficients and hessian. Use the `mvrnorm()` function from the `MASS` library.

b) Use the draws to compute the mean WTP and 95% confidence intervals of WTP for fuel economy and electric car vehicle type.
]

---

# .center[Computing WTP from an estimated model]

&lt;br&gt;

.rightcol80[
## 1. Open `logitr-cars`

## 2. Open `code/6.1-compute-wtp.R`
]

---

class: inverse

<div class="countdown" id="timer_618bd316" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

.leftcol80[.font120[
As a team, compute the WTP from an estimated model you used in your pilot analysis report
]]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. .orange[Directly Estimating WTP]

### BREAK

### 4. Simulating Market Shares

---

class: center 

## Willingness to Pay (WTP)

.leftcol[
## "Preference Space"

## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`
]

--

.rightcol[
## "WTP Space"

## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`
## `$$\lambda = - \alpha$$`
## `$$\tilde{u}_j = \lambda (\boldsymbol{\omega} x_j - p_j) + \tilde{\varepsilon_j}$$`
]

---

class: center 

# WTP space models have **non-convex**&lt;br&gt;log-likelihood functions!

&lt;center&gt;
&lt;img src="images/conditions.png" width=850&gt;
&lt;/center&gt;

---

class: center 

# WTP space models have non-convex&lt;br&gt;log-likelihood functions!

&lt;br&gt;

# **Use multi-start loop with&lt;br&gt;random starting points**

---

# .center[Computing WTP from an estimated model]

&lt;br&gt;

.rightcol80[
## 1. Open `logitr-cars`

## 2. Open `code/6.2-model-wtp.R`
]

---

class: inverse

<div class="countdown" id="timer_618bd14e" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

.leftcol80[.font120[
As a team, re-estimate the main model you used in your pilot analysis report, but now in the WTP space.

Try plotting your results (see `6.3-plot-wtp.R` for examples)
]]

---

class: inverse, center

# .fancy[Break]

<div class="countdown" id="timer_618bd040" style="top:1;right:0;bottom:0;left:0;margin:5%;font-size:8em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. .orange[Simulating Market Shares]

---

class: center

## We want to find `\(\boldsymbol{\beta}\)` by maximizing the log-likelihood

&lt;center&gt;
&lt;img src="images/mle1.png" width=1000&gt;
&lt;img src="images/mle2.png" width=500&gt;
&lt;/center&gt;

---

# .center[Simulate Market Shares]

## 1. Define a market, `\(X\)`

## 2. Compute shares:

## `$$\hat{P}_j = \frac{e^{\hat{\boldsymbol{\beta}}'\boldsymbol{X}_j}}{\sum_{k=1}^J e^{\hat{\boldsymbol{\beta}}'\boldsymbol{X}_k}}$$`

---

# .center[Simulate Market Shares]

&lt;center&gt;
&lt;img src="images/matrixmath.png" width=700&gt;
&lt;/center&gt;

---

# .center[Simulate Market Shares]

.leftcol70[
&lt;center&gt;
&lt;img src="images/matrixmath.png" width=700&gt;
&lt;/center&gt;
]

.rightcol30[
In R:

```r
X %*% beta
```
]

---

class: inverse

# Practice Question 1

.leftcol[

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

The estimated model produces the following coefficients:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

]

.rightcol[
a) Use the estimated coefficients to compute the WTP for fuel economy and electric car vehicle type.

b) Use the estimated coefficients to compute market shares for the alternatives in the following market:


alternative | price | mpg | elec
------------|-------|-----|--------
1 | 15 | 20 | 0
2 | 30 | 100 | 1
3 | 20 | 40 | 0
]

---

# .center[Simulating Market Shares with Uncertainty]

We can use the coefficients and hessian from a model to obtain draws that reflect parameter uncertainty

.leftcol[

```r
beta &lt;- c(-0.7, 0.1, -4.0)

hessian &lt;- matrix(c(
    -6000,   50,   60,
       50, -700,   50,
       60,   50, -300),
    ncol = 3, byrow = TRUE)
```
]

.rightcol[

```r
covariance &lt;- -1*solve(hessian)
draws &lt;- MASS::mvrnorm(10^4, beta, covariance)

head(draws)
```

```
#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.6879834 0.10121397 -3.971613
#&gt; [2,] -0.7120454 0.12175361 -3.950361
#&gt; [3,] -0.7327005 0.08784529 -3.996177
#&gt; [4,] -0.7040887 0.12114425 -4.011338
#&gt; [5,] -0.6882495 0.09595869 -3.948449
#&gt; [6,] -0.7021672 0.10389165 -4.018493
```
]

---

# .center[Simulating Market Shares with Uncertainty]

Rely on the `predict()` function to compute shares with uncertainty. 

Internally, it:

1. Takes draws of `\(\boldsymbol{\beta}\)`
2. Computes `\(P_j\)` for each draw 
3. Returns mean and confidence interval computed from draws

---

# .center[Simulating Market Shares with Uncertainty]

&lt;br&gt;

.rightcol80[
## 1. Open `logitr-cars`

## 2. Open `code/7.1-compute-market-sims.R`
]

---

class: inverse

<div class="countdown" id="timer_618bd163" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

## As a team: 

1. Develop one or two scenarios pitting your product against one or more competitors. 
2. Use one of your estimated models and the `predict()` function to predict market shares for those scenarios. 
3. Try plotting your results (see `7.2-plot-market-sims.R` for examples)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
